using System.Linq;
using Discoursistency.Base.Models.Retrieving;
using Discoursistency.HTTP.Client.Models;
using NUnit.Framework;

namespace Discoursistency.NUnit.Discoursistency.Base
{
    [TestFixture]
    public class ModelTranslationTests
    {
        [Test]
        public void PostModel()
        {
            var response =
                HTTPClientContent.FromJSONString(
                    @"{""id"":136804,""name"":""' OR 1=1; DROP TABLE TDWTF; --"",""username"":""Maciejasjmj"",""avatar_template"":""/user_avatar/what.thedailywtf.com/maciejasjmj/{size}/1887.png"",""uploaded_avatar_id"":1887,""created_at"":""2014-10-29T10:33:28.507Z"",""cooked"":""<aside class=\""onebox whitelistedgeneric\"">\n  <header class=\""source\"">\n    <a href=\""https://github.com/Mivexil/Discoursistency\"">\n      github.com\n    </a>\n  </header>\n  <article class=\""onebox-body\"">\n    <img src=\""https://avatars0.githubusercontent.com/u/5994816?v=2&amp;s=400\"" class=\""thumbnail\"" width=\""141\"" height=\""141\"">\n\n<h3><a href=\""https://github.com/Mivexil/Discoursistency\"">Mivexil/Discoursistency</a></h3>\n\n<p>Discoursistency - A Discourse API. Now with added sanity.</p>\n\n  </article>\n  <div style=\""clear: both\""></div>\n</aside>\n\n\n<p>Now implemented (somewhat):</p>\n\n<ul>\n<li>logging in</li>\n<li>posting (obviously)</li>\n<li>post actions (like/bookmark/etc)</li>\n<li>removing post actions (apparently that's, like, totally separate)</li>\n<li>editing posts</li>\n<li>deleting posts</li>\n<li>\""reading\"" posts (sending timings)</li>\n<li>also, burst rate-limiting (which would probably be easily extended to proper limiting, but-oh-well)</li>\n</ul>\n\n<p>Todo:<br>- exposing the message bus (a separate thread running longpoll?)<br>- retrieving posts (which ones? how? you can't get more than one raw per request, but cooked is useless for processing, unless you're into stripping HTML and exposing yourself to shitton of abuse)</p>"",""post_number"":1,""post_type"":1,""updated_at"":""2014-10-29T15:17:33.903Z"",""reply_count"":1,""reply_to_post_number"":null,""quote_count"":0,""avg_time"":51,""incoming_link_count"":0,""reads"":59,""score"":79.34999999999999,""yours"":true,""topic_id"":4469,""topic_slug"":""im-doing-a-discourse-api-now-on-github-throw-me-the-features-you-want-also-random-ramblings-thread"",""topic_auto_close_at"":null,""display_username"":""' OR 1=1; DROP TABLE TDWTF; --"",""primary_group_name"":null,""version"":2,""can_edit"":true,""can_delete"":false,""can_recover"":false,""user_title"":""<kbd>XSS Award</kbd>"",""raw"":""https://github.com/Mivexil/Discoursistency\n\nNow implemented (somewhat):\n\n- logging in\n- posting (obviously)\n- post actions (like/bookmark/etc)\n- removing post actions (apparently that's, like, totally separate)\n- editing posts\n- deleting posts\n- \""reading\"" posts (sending timings)\n- also, burst rate-limiting (which would probably be easily extended to proper limiting, but-oh-well)\n\nTodo:\n- exposing the message bus (a separate thread running longpoll?)\n- retrieving posts (which ones? how? you can't get more than one raw per request, but cooked is useless for processing, unless you're into stripping HTML and exposing yourself to shitton of abuse)"",""actions_summary"":[{""id"":2,""count"":2,""hidden"":false,""can_act"":false},{""id"":3,""count"":0,""hidden"":false,""can_act"":true,""can_defer_flags"":false},{""id"":4,""count"":0,""hidden"":false,""can_act"":true,""can_defer_flags"":false},{""id"":5,""count"":0,""hidden"":true,""can_act"":true,""can_defer_flags"":false},{""id"":6,""count"":0,""hidden"":false,""can_act"":false},{""id"":7,""count"":0,""hidden"":false,""can_act"":true,""can_defer_flags"":false},{""id"":8,""count"":0,""hidden"":false,""can_act"":true,""can_defer_flags"":false}],""moderator"":false,""admin"":false,""staff"":false,""user_id"":261,""hidden"":false,""hidden_reason_id"":null,""trust_level"":3,""deleted_at"":null,""user_deleted"":false,""edit_reason"":"""",""can_view_edit_history"":true,""wiki"":false}");
            var model = response.GetObject<PostModel>();
            Assert.AreEqual(4, model.actions_summary.ElementAt(2).id);
        }

        [Test]
        public void UserModel()
        {
            var response =
                HTTPClientContent.FromJSONString(
                    @"{""user_badges"":[{""id"":48732,""granted_at"":""2014-10-13T04:00:32.791Z"",""badge_id"":3,""user_id"":671,""granted_by_id"":-1},{""id"":56215,""granted_at"":""2014-11-01T00:00:00.000Z"",""badge_id"":165,""user_id"":671,""granted_by_id"":-1},{""id"":50204,""granted_at"":""2014-10-17T15:27:48.574Z"",""badge_id"":128,""user_id"":671,""granted_by_id"":20}],""badges"":[{""id"":3,""name"":""Regular"",""description"":null,""grant_count"":68,""allow_title"":true,""multiple_grant"":false,""icon"":""fa-user"",""image"":null,""listable"":true,""enabled"":true,""badge_grouping_id"":4,""system"":true,""badge_type_id"":2},{""id"":165,""name"":""Too Much Time On My Hands"",""description"":""Top poster in the past month. See 2^0 badge for general criteria for which posts count."",""grant_count"":1,""allow_title"":true,""multiple_grant"":false,""icon"":""fa-spoon"",""image"":"""",""listable"":true,""enabled"":true,""badge_grouping_id"":17,""system"":false,""badge_type_id"":1},{""id"":128,""name"":""Someone didn't get the joke"",""description"":""Badge of shame when someone seriously Didn't Get The Joke™"",""grant_count"":12,""allow_title"":false,""multiple_grant"":true,""icon"":""fa-meh-o"",""image"":null,""listable"":true,""enabled"":true,""badge_grouping_id"":5,""system"":false,""badge_type_id"":2}],""badge_types"":[{""id"":2,""name"":""Silver"",""sort_order"":8},{""id"":1,""name"":""Gold"",""sort_order"":9}],""users"":[{""id"":671,""username"":""accalia"",""uploaded_avatar_id"":8425,""avatar_template"":""/user_avatar/what.thedailywtf.com/accalia/{size}/8425.png""},{""id"":-1,""username"":""system"",""uploaded_avatar_id"":4495,""avatar_template"":""/user_avatar/what.thedailywtf.com/system/{size}/4495.png""},{""id"":20,""username"":""PJH"",""uploaded_avatar_id"":9096,""avatar_template"":""/user_avatar/what.thedailywtf.com/pjh/{size}/9096.png""}],""user"":{""id"":671,""username"":""accalia"",""uploaded_avatar_id"":8425,""avatar_template"":""/user_avatar/what.thedailywtf.com/accalia/{size}/8425.png"",""name"":""Accalia Fairyfox"",""last_posted_at"":""2014-11-06T18:49:37.221Z"",""last_seen_at"":""2014-11-06T19:49:39.448Z"",""bio_raw"":""Not necessarily evil, but most definitely mischievous.\n\n---\n\nI am a cyborg. A bot performs some automatic behaviors on my behalf. If you suspect my cyborg side is misbehaving please Email me and i'll correct the issue."",""bio_cooked"":""<p>Not necessarily evil, but most definitely mischievous.</p>\n\n<hr>\n\n<p>I am a cyborg. A bot performs some automatic behaviors on my behalf. If you suspect my cyborg side is misbehaving please Email me and i'll correct the issue.</p>"",""created_at"":""2014-05-30T21:06:08.981Z"",""website"":""https://staradept.com"",""location"":""Sector ZZ9 Plural Zed Alpha"",""can_edit"":false,""can_edit_username"":false,""can_edit_email"":false,""can_edit_name"":false,""stats"":[{""action_type"":4,""count"":45,""id"":null},{""action_type"":5,""count"":5809,""id"":null},{""action_type"":6,""count"":4870,""id"":null},{""action_type"":1,""count"":20578,""id"":null},{""action_type"":2,""count"":17344,""id"":null},{""action_type"":7,""count"":192,""id"":null},{""action_type"":9,""count"":112,""id"":null},{""action_type"":11,""count"":11,""id"":null}],""can_send_private_message_to_user"":true,""bio_excerpt"":""Not necessarily evil, but most definitely mischievous. \n\n\n\nI am a cyborg. A bot performs some automatic behaviors on my behalf. If you suspect my cyborg side is misbehaving please Email me and i&#39;ll correct the issue."",""trust_level"":3,""moderator"":false,""admin"":false,""title"":null,""badge_count"":31,""custom_fields"":{},""invited_by"":null,""custom_groups"":[{""id"":49,""automatic"":false,""name"":""programmers_testers"",""user_count"":23,""alias_level"":null,""visible"":true}],""featured_user_badge_ids"":[48732,56215,50204],""card_badge"":null}}"
                    );
            var model = response.GetObject<UserModel>();
            Assert.AreEqual(model.user.custom_groups.ElementAt(0).id, 49);
        }

        [Test]
        public void MyUserModel()
        {
            var response =
                HTTPClientContent.FromJSONString(
                        @"{""user_badges"":[{""id"":22671,""granted_at"":""2014-07-18T04:00:01.469Z"",""badge_id"":3,""user_id"":261,""granted_by_id"":-1},{""id"":21645,""granted_at"":""2014-07-15T14:16:33.936Z"",""badge_id"":105,""user_id"":261,""granted_by_id"":20},{""id"":56274,""granted_at"":""2014-11-02T00:00:00.000Z"",""badge_id"":163,""user_id"":261,""granted_by_id"":-1}],""badges"":[{""id"":3,""name"":""Regular"",""description"":null,""grant_count"":68,""allow_title"":true,""multiple_grant"":false,""icon"":""fa-user"",""image"":null,""listable"":true,""enabled"":true,""badge_grouping_id"":4,""system"":true,""badge_type_id"":2},{""id"":105,""name"":""<kbd>XSS Award</kbd>"",""description"":""Finders of XSS exploits, awarded at admins' discretion."",""grant_count"":20,""allow_title"":true,""multiple_grant"":true,""icon"":""fa-keyboard-o "",""image"":null,""listable"":true,""enabled"":true,""badge_grouping_id"":8,""system"":false,""badge_type_id"":1},{""id"":163,""name"":""10% Poster"",""description"":""Be one of the top 5%-10% posters in the past month with more than one post. See 2^0 badge for general criteria for which posts count."",""grant_count"":12,""allow_title"":true,""multiple_grant"":false,""icon"":""fa-bolt"",""image"":"""",""listable"":true,""enabled"":true,""badge_grouping_id"":17,""system"":false,""badge_type_id"":2}],""badge_types"":[{""id"":2,""name"":""Silver"",""sort_order"":8},{""id"":1,""name"":""Gold"",""sort_order"":9}],""users"":[{""id"":261,""username"":""Maciejasjmj"",""uploaded_avatar_id"":1887,""avatar_template"":""/user_avatar/what.thedailywtf.com/maciejasjmj/{size}/1887.png""},{""id"":-1,""username"":""system"",""uploaded_avatar_id"":4495,""avatar_template"":""/user_avatar/what.thedailywtf.com/system/{size}/4495.png""},{""id"":20,""username"":""PJH"",""uploaded_avatar_id"":9096,""avatar_template"":""/user_avatar/what.thedailywtf.com/pjh/{size}/9096.png""}],""user"":{""id"":261,""username"":""Maciejasjmj"",""uploaded_avatar_id"":1887,""avatar_template"":""/user_avatar/what.thedailywtf.com/maciejasjmj/{size}/1887.png"",""name"":""' OR 1=1; DROP TABLE TDWTF; --"",""email"":""mackozbogdanca@gmail.com"",""last_posted_at"":""2014-11-06T19:44:40.090Z"",""last_seen_at"":""2014-11-06T19:56:12.556Z"",""bio_raw"":""Just doing this for a badge."",""bio_cooked"":""<p>Just doing this for a badge.</p>"",""created_at"":""2014-05-19T22:04:37.030Z"",""website"":""http://"",""can_edit"":true,""can_edit_username"":false,""can_edit_email"":true,""can_edit_name"":true,""stats"":[{""action_type"":13,""count"":23,""id"":null},{""action_type"":12,""count"":13,""id"":null},{""action_type"":4,""count"":46,""id"":null},{""action_type"":5,""count"":1537,""id"":null},{""action_type"":6,""count"":1423,""id"":null},{""action_type"":1,""count"":15347,""id"":null},{""action_type"":2,""count"":2322,""id"":null},{""action_type"":7,""count"":44,""id"":null},{""action_type"":9,""count"":73,""id"":null},{""action_type"":11,""count"":66,""id"":null}],""can_send_private_message_to_user"":false,""bio_excerpt"":""Just doing this for a badge."",""trust_level"":3,""moderator"":false,""admin"":false,""title"":""<kbd>XSS Award</kbd>"",""badge_count"":34,""notification_count"":1520,""has_title_badges"":true,""edit_history_public"":false,""custom_fields"":{},""locale"":"""",""email_digests"":true,""email_private_messages"":true,""email_direct"":true,""email_always"":false,""digest_after_days"":7,""mailing_list_mode"":false,""auto_track_topics_after_msecs"":0,""new_topic_duration_minutes"":-1,""external_links_in_new_tab"":false,""dynamic_favicon"":true,""enable_quoting"":true,""muted_category_ids"":[],""tracked_category_ids"":[],""watched_category_ids"":[],""private_messages_stats"":{""all"":11,""mine"":7,""unread"":0},""disable_jump_reply"":false,""gravatar_avatar_upload_id"":null,""custom_avatar_upload_id"":null,""invited_by"":null,""custom_groups"":[{""id"":49,""automatic"":false,""name"":""programmers_testers"",""user_count"":23,""alias_level"":null,""visible"":true}],""featured_user_badge_ids"":[22671,21645,56274],""card_badge"":null}}"
                    );
            var model = response.GetObject<UserModel>();
            Assert.AreEqual(model.user.auto_track_topics_after_msecs, 0);
        }
    }
}
